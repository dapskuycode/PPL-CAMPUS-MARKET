generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  idUser            Int       @id @default(autoincrement())
  nama              String    @db.VarChar(255)
  noHP              String    @db.VarChar(20)
  email             String    @unique @db.VarChar(255)
  alamatJalan       String    @db.VarChar(255)
  rt                String    @db.VarChar(10)
  rw                String    @db.VarChar(10)
  namaKelurahan     String    @db.VarChar(100)
  kabupatenKota     String    @db.VarChar(100)
  provinsi          String    @db.VarChar(100)
  noKtp             String?   @db.VarChar(30)
  fotoKtp           String?   @db.VarChar(255)
  fileUploadPIC     String?   @db.VarChar(255)
  statusVerifikasi  String?   @default("pending") @db.VarChar(20)
  tanggalVerifikasi DateTime? @db.Timestamp(6)
  statusAkun        String?   @default("aktif") @db.VarChar(20)
  tanggalDaftar     DateTime? @default(now()) @db.Timestamp(6)
  role              String    @default("pembeli") @db.VarChar(50)
  password          String    @db.VarChar(255)
  kecamatan         String?   @db.VarChar(100)
  product           Product[] @relation("SellerProducts")
  toko              Toko?
  cart              Cart[]
  order             Order[]

  @@index([email])
  @@index([role])
  @@index([statusVerifikasi])
  @@map("users")
}

model Toko {
  idToko           Int     @id @default(autoincrement())
  namaToko         String  @db.VarChar(255)
  idSeller         Int     @unique
  deskripsiSingkat String? @db.Text
  seller           User    @relation(fields: [idSeller], references: [idUser], onDelete: Cascade)

  @@index([namaToko])
  @@map("toko")
}

model Category {
  idCategory   Int       @id @default(autoincrement())
  namaKategori String    @unique @db.VarChar(255)
  product      Product[]

  @@index([namaKategori])
  @@map("categories")
}

model Product {
  idProduct     Int            @id @default(autoincrement())
  idSeller      Int
  idCategory    Int?
  namaProduk    String         @db.VarChar(255)
  deskripsi     String?        @db.Text
  harga         Decimal        @db.Decimal(15, 2)
  stok          Int            @default(0)
  berat         Decimal?       @db.Decimal(10, 2)
  kondisi       String         @default("baru") @db.VarChar(10)
  lokasi        String?        @db.VarChar(255)
  tanggalUpload DateTime       @default(now()) @db.Timestamp(6)
  statusProduk  String         @default("aktif") @db.VarChar(20)
  category      Category?      @relation(fields: [idCategory], references: [idCategory], onDelete: SetNull)
  seller        User           @relation("SellerProducts", fields: [idSeller], references: [idUser], onDelete: Cascade)
  productImage  ProductImage[]
  rating        Rating[]
  cart          Cart[]
  orderItem     OrderItem[]

  @@index([idSeller])
  @@index([idCategory])
  @@index([statusProduk])
  @@index([namaProduk])
  @@map("products")
}

model ProductImage {
  idImage    Int     @id @default(autoincrement())
  idProduct  Int
  namaGambar String  @db.VarChar(255)
  urutan     Int     @default(1)
  product    Product @relation(fields: [idProduct], references: [idProduct], onDelete: Cascade)

  @@index([idProduct])
  @@map("product_images")
}

model Rating {
  idRating       Int      @id @default(autoincrement())
  idProduct      Int
  namaPengunjung String   @db.VarChar(255)
  email          String?  @db.VarChar(255)
  noHP           String?  @db.VarChar(20)
  komentar       String?  @db.Text
  nilai          Int
  tanggal        DateTime @default(now()) @db.Timestamp(6)
  product        Product  @relation(fields: [idProduct], references: [idProduct], onDelete: Cascade)

  @@index([idProduct])
  @@index([nilai])
  @@map("ratings")
}

model Cart {
  idCart     Int      @id @default(autoincrement())
  idUser     Int
  idProduct  Int
  quantity   Int      @default(1)
  createdAt  DateTime @default(now()) @db.Timestamp(6)
  user       User     @relation(fields: [idUser], references: [idUser], onDelete: Cascade)
  product    Product  @relation(fields: [idProduct], references: [idProduct], onDelete: Cascade)

  @@unique([idUser, idProduct])
  @@index([idUser])
  @@index([idProduct])
  @@map("cart")
}

model Order {
  idOrder         Int         @id @default(autoincrement())
  idUser          Int
  totalPrice      Decimal     @db.Decimal(15, 2)
  status          String      @default("pending") @db.VarChar(50)
  paymentMethod   String?     @db.VarChar(50)
  shippingAddress String?     @db.Text
  orderDate       DateTime    @default(now()) @db.Timestamp(6)
  updatedAt       DateTime    @updatedAt @db.Timestamp(6)
  orderNotes      String?     @db.Text
  user            User        @relation(fields: [idUser], references: [idUser], onDelete: Cascade)
  orderItem       OrderItem[]

  @@index([idUser])
  @@index([status])
  @@index([orderDate])
  @@map("orders")
}

model OrderItem {
  idOrderItem Int     @id @default(autoincrement())
  idOrder     Int
  idProduct   Int
  quantity    Int
  price       Decimal @db.Decimal(15, 2)
  order       Order   @relation(fields: [idOrder], references: [idOrder], onDelete: Cascade)
  product     Product @relation(fields: [idProduct], references: [idProduct], onDelete: Cascade)

  @@index([idOrder])
  @@index([idProduct])
  @@map("order_items")
}
